import{r as l,j as e,u as G,H as be,t as f,a as R}from"./app-BTymDE-b.js";import{B as A}from"./button-0cFyQk5l.js";import{P as ae,a as te,C as re,b as le,c as E,d as F,e as I,f as k,g as B,h as Y}from"./popover-DxWEQViG.js";import{c as b}from"./utils-BkIxhzDH.js";import{C as H}from"./check-CpxbXbUo.js";import{u as ve,P as Ne}from"./PercentInput-4iciqJmC.js";import{P as De}from"./Index-BJE5hFwe.js";import{A as U,a as K,b as Q,c as V,d as W,e as X,f as Z,g as ee}from"./alert-dialog-DiBo0ReV.js";import{D as ye,a as Se,b as _e,c as Ce,d as se,e as Ae}from"./dropdown-menu-8hpJ0En7.js";import{T as we,a as Me,b as $,c as y,d as Oe,e as g}from"./table-DufyZNTU.js";import{A as Pe}from"./app-layout-Ctney_0w.js";import{T as C}from"./index-CnTLoYi9.js";import{E as Te}from"./ellipsis-ChGD3H5v.js";import{T as Re}from"./trash-2-Bf6h3e5I.js";/* empty css            */import"./createLucideIcon-CdDXl1n5.js";import"./index-B3n4jYYB.js";import"./index-CcDKZjMs.js";import"./index-C9ZXAN1u.js";import"./index-C1SMWg6O.js";import"./search-CIJ9iWFu.js";import"./index-DOyuSIH3.js";import"./index-Dc_FVRD7.js";import"./input-CeqObPA2.js";import"./select-CXekZFRK.js";import"./index-BjsA19nC.js";import"./index-85cLjII4.js";import"./proxy-BMoTdZYb.js";const ne=[{mm:"01",label:"Janeiro"},{mm:"02",label:"Fevereiro"},{mm:"03",label:"Março"},{mm:"04",label:"Abril"},{mm:"05",label:"Maio"},{mm:"06",label:"Junho"},{mm:"07",label:"Julho"},{mm:"08",label:"Agosto"},{mm:"09",label:"Setembro"},{mm:"10",label:"Outubro"},{mm:"11",label:"Novembro"},{mm:"12",label:"Dezembro"}],$e=Array.from({length:102},(i,c)=>String(2101-c));function Ee({value:i,onChange:c}){const[p,u]=l.useState(!1),h=new Date,v=String(h.getFullYear()),N=String(h.getMonth()+1).padStart(2,"0"),a=i?.slice(0,4)??v,r=i?.slice(5,7)??N,x=(n,d)=>{c(`${n}-${d}`),u(!1)},D=l.useMemo(()=>`${ne.find(d=>d.mm===r)?.label??r}/${a}`,[r,a]);return e.jsxs(ae,{open:p,onOpenChange:u,children:[e.jsx(te,{asChild:!0,children:e.jsxs(A,{variant:"outline",role:"combobox","aria-expanded":p,className:"w-48 justify-between",children:[D,e.jsx(re,{className:"size-4 opacity-50"})]})}),e.jsx(le,{className:"w-[360px] p-0",align:"start",children:e.jsxs("div",{className:"grid grid-cols-2 divide-x",children:[e.jsxs(E,{children:[e.jsx(F,{placeholder:"Buscar mês…",className:"h-9"}),e.jsxs(I,{children:[e.jsx(k,{children:"Nenhum mês"}),e.jsx(B,{heading:"Meses",children:ne.map(n=>e.jsxs(Y,{value:n.mm,onSelect:()=>x(a,n.mm),children:[n.label,e.jsx(H,{className:b("ml-auto",r===n.mm?"opacity-100":"opacity-0")})]},n.mm))})]})]}),e.jsxs(E,{children:[e.jsx(F,{placeholder:"Buscar ano…",className:"h-9"}),e.jsxs(I,{children:[e.jsx(k,{children:"Nenhum ano"}),e.jsx(B,{heading:"Anos",children:$e.map(n=>e.jsxs(Y,{value:n,onSelect:()=>x(n,r),children:[n,e.jsx(H,{className:b("ml-auto",a===n?"opacity-100":"opacity-0")})]},n))})]})]})]})})]})}function Fe({value:i,onChange:c,items:p,placeholder:u="Selecione...",searchPlaceholder:h="Buscar...",emptyMessage:v="Nenhum item encontrado.",className:N,buttonClassName:a,buttonRightIcon:r,disabled:x,contentWidthClass:D}){const[n,d]=l.useState(!1),S=p.find(m=>m.value===i);return e.jsx("div",{className:b("w-full",N),children:e.jsxs(ae,{open:n,onOpenChange:d,children:[e.jsx(te,{asChild:!0,children:e.jsxs(A,{type:"button",variant:"outline",role:"combobox","aria-expanded":n,disabled:x,className:b("w-full justify-between",a),children:[e.jsx("span",{className:"truncate",children:S?S.label:u}),r??e.jsx(re,{className:"ml-2 h-4 w-4 opacity-50"})]})}),e.jsx(le,{className:b("p-0",D??"w-[--radix-popover-trigger-width]"),align:"start",children:e.jsxs(E,{children:[e.jsx(F,{placeholder:h,className:"h-9"}),e.jsxs(I,{children:[e.jsx(k,{children:v}),e.jsx(B,{children:p.map(m=>e.jsxs(Y,{value:m.value,onSelect:j=>{c(j===i?"":j),d(!1)},children:[e.jsx("span",{className:"truncate",children:m.label}),e.jsx(H,{className:b("ml-auto h-4 w-4",i===m.value?"opacity-100":"opacity-0")})]},m.value))})]})]})})]})})}function ms({plans:i,yields:c,filters:p}){const{data:u,setData:h}=G({per_page:Number(p?.per_page??15)}),v=s=>{R.get(C("admin.monthly-yields.index"),{...u,...s},{preserveScroll:!0,preserveState:!0})},N=s=>{h("per_page",s),v({per_page:s})},{data:a,setData:r,post:x,processing:D,errors:n,reset:d,transform:S}=G({investment_plan_id:"",period:new Date().toISOString().slice(0,7),percent_decimal:""}),{display:m,setDisplay:j,getDecimal:L}=ve();l.useEffect(()=>{j(a.percent_decimal)},[a.percent_decimal]);const oe=i.map(s=>({value:String(s.id),label:s.name})),ie=s=>{if(s.preventDefault(),!a.investment_plan_id||!/^\d{4}-\d{2}$/.test(a.period))return;const t=L();S(o=>({investment_plan_id:o.investment_plan_id,period:`${o.period}-01`,percent_decimal:t})),x(C("admin.monthly-yields.store"),{onSuccess:()=>{f.success("Rendimento registrado com sucesso."),d(),j("")},onError:()=>{f.error("Erro ao registrar rendimento. Verifique os campos.")}})},[ce,w]=l.useState(null),[de,M]=l.useState(!1),[O,me]=l.useState(null),q=l.useRef(null),pe=s=>{w(null),document.activeElement?.blur?.(),me({id:s.id,label:`${s.plan?.name??"Plano"} — ${T(s.period)}`}),requestAnimationFrame(()=>M(!0))},ue=()=>{O&&R.delete(C("admin.monthly-yields.destroy",{monthlyYield:O.id}),{preserveState:!0,onSuccess:()=>f.success("Rendimento removido com sucesso."),onError:()=>f.error("Erro ao remover rendimento. Tente novamente."),onFinish:()=>M(!1)})},[he,P]=l.useState(!1),[_,xe]=l.useState(null),z=l.useRef(null),je=s=>{w(null),document.activeElement?.blur?.(),xe({planId:s.investment_plan_id,period:J(s.period),label:`${s.plan?.name??"Plano"} — ${T(s.period)}`}),requestAnimationFrame(()=>P(!0))},fe=()=>{_&&R.post(C("admin.monthly-yields.apply"),{investment_plan_id:_.planId,period:_.period},{preserveState:!0,onSuccess:()=>f.success("Rendimento aplicado com sucesso."),onError:()=>f.error("Erro ao aplicar rendimento. Tente novamente."),onFinish:()=>P(!1)})},ge=s=>{const t=typeof s=="string"?parseFloat(s):s;return typeof t=="number"&&!isNaN(t)?`${(t*100).toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2})}%`:"—"};function J(s){if(/^\d{4}-\d{2}$/.test(s))return`${s}-01`;if(/^\d{4}-\d{2}-\d{2}$/.test(s))return`${s.slice(0,7)}-01`;const t=new Date(s);return isNaN(t.getTime())?s:`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-01`}function T(s){const[t,o]=J(s).split("-").map(Number);return new Date(t,(o??1)-1).toLocaleDateString("pt-BR",{year:"numeric",month:"2-digit"})}return e.jsxs(Pe,{children:[e.jsx(be,{title:"Rendimentos Mensais"}),e.jsxs("div",{className:"rounded-xl bg-accent px-3 pt-4",children:[e.jsx("div",{className:"mb-2 flex flex-col items-start justify-between gap-4 sm:flex-row sm:items-center",children:e.jsx("h1",{className:"text-lg font-bold",children:"Rendimentos Mensais"})}),e.jsxs("form",{onSubmit:ie,className:"mb-4 rounded-lg border bg-card p-4",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-3 sm:grid-cols-4",children:[e.jsxs("div",{className:"sm:col-span-2",children:[e.jsx("label",{className:"mb-1 block text-sm font-medium",children:"Plano"}),e.jsx(Fe,{value:a.investment_plan_id,onChange:s=>r("investment_plan_id",s),items:oe,placeholder:"Selecione um plano",emptyMessage:"Nenhum plano encontrado"}),n.investment_plan_id&&e.jsx("p",{className:"mt-1 text-sm text-destructive",children:n.investment_plan_id})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium",children:"Mês"}),e.jsx(Ee,{value:a.period,onChange:s=>r("period",s)}),n.period&&e.jsx("p",{className:"mt-1 text-sm text-destructive",children:n.period})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium",children:"Rendimento (%)"}),e.jsx(Ne,{value:m,onChange:s=>{j(s),r("percent_decimal",s)},placeholder:"0,00"}),n.percent_decimal&&e.jsx("p",{className:"mt-1 text-sm text-destructive",children:n.percent_decimal})]})]}),e.jsx("div",{className:"mt-4 flex justify-end",children:e.jsx(A,{type:"submit",disabled:D,children:"Registrar"})})]}),e.jsxs("div",{className:"mb-4 rounded-lg",children:[e.jsxs(we,{children:[e.jsx(Me,{children:e.jsxs($,{children:[e.jsx(y,{children:"ID"}),e.jsx(y,{children:"Plano"}),e.jsx(y,{children:"Mês"}),e.jsx(y,{children:"Percentual"}),e.jsx(y,{className:"text-right",children:e.jsx("span",{className:"sr-only",children:"Ações"})})]})}),e.jsx(Oe,{children:c?.data?.length?c.data.map(s=>{const t=ce===s.id;return e.jsxs($,{className:"hover:!bg-secondary/10",children:[e.jsx(g,{children:s.id}),e.jsx(g,{className:"max-w-48 truncate",children:s.plan?.name??"—"}),e.jsx(g,{children:T(s.period)}),e.jsx(g,{children:ge(s?.percent_decimal)}),e.jsx(g,{className:"text-right",children:e.jsxs(ye,{open:t,onOpenChange:o=>w(o?s.id:null),children:[e.jsx(Se,{asChild:!0,children:e.jsxs(A,{variant:"ghost",className:"h-8 w-8 p-0",children:[e.jsx("span",{className:"sr-only",children:"Abrir menu"}),e.jsx(Te,{className:"h-4 w-4"})]})}),e.jsxs(_e,{align:"end",children:[e.jsx(Ce,{children:"Ações"}),e.jsx(se,{onSelect:o=>{o.preventDefault(),je(s)},children:"Aplicar rendimento"}),e.jsx(Ae,{}),e.jsxs(se,{className:"text-red-600 focus:text-red-600",onSelect:o=>{o.preventDefault(),pe(s)},children:[e.jsx(Re,{className:"mr-2 h-4 w-4"}),"Remover"]})]})]})})]},s.id)}):e.jsx($,{children:e.jsx(g,{colSpan:5,className:"h-24 text-center text-sm text-muted-foreground",children:"Nenhum rendimento cadastrado."})})})]}),e.jsx(De,{meta:c.meta,perPage:u.per_page,setPerPage:N})]})]}),e.jsx(U,{open:de,onOpenChange:M,children:e.jsxs(K,{onOpenAutoFocus:s=>{s.preventDefault(),q.current?.focus()},children:[e.jsxs(Q,{children:[e.jsx(V,{children:"Remover rendimento?"}),e.jsx(W,{children:O?.label})]}),e.jsxs(X,{children:[e.jsx(Z,{ref:q,children:"Cancelar"}),e.jsx(ee,{className:"bg-red-600 hover:bg-red-700",onClick:ue,children:"Remover"})]})]})}),e.jsx(U,{open:he,onOpenChange:P,children:e.jsxs(K,{onOpenAutoFocus:s=>{s.preventDefault(),z.current?.focus()},children:[e.jsxs(Q,{children:[e.jsx(V,{children:"Aplicar rendimento deste mês?"}),e.jsxs(W,{children:[_?.label,e.jsx("br",{}),"Esta ação irá lançar o rendimento como transações aprovadas para todos os vínculos ativos deste plano que já estavam ativados até o fim do período selecionado."]})]}),e.jsxs(X,{children:[e.jsx(Z,{ref:z,children:"Cancelar"}),e.jsx(ee,{onClick:fe,children:"Aplicar rendimento"})]})]})})]})}export{ms as default};
