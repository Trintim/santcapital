import{u as b,r as o,j as e,H as k,L as y,t as u}from"./app-D1QTuDhJ.js";import{C as m}from"./combobox-BRdqbPTh.js";import{B as x}from"./button-CjsFrxyq.js";import{C as N,a as P,b as B,c as E}from"./card-POPs74si.js";import{L as d}from"./label-C8iPZTTK.js";import{A as L}from"./app-layout-CJjyHprM.js";/* empty css            */import"./popover-CrdbZeVi.js";import"./createLucideIcon-DFi8gACE.js";import"./index-2tsdWD63.js";import"./index-DwBoTTRC.js";import"./index-B9yUo-Ai.js";import"./index-DvlxdSxl.js";import"./utils-BkIxhzDH.js";import"./search-CTwqVz6b.js";import"./index-DGw6JHWd.js";import"./index-Dc_FVRD7.js";import"./check-tbf6p6GB.js";import"./input-CHa5w17A.js";import"./index-CzgvQrgu.js";import"./dropdown-menu-CRqzibls.js";function Y({customers:p,plans:l}){const{data:r,setData:i,post:h,processing:_,errors:t}=b({user_id:"",investment_plan_id:"",chosen_lockup_days:""}),[n,j]=o.useState(null),f=o.useMemo(()=>p.map(a=>({value:String(a.id),label:`${a.name} — ${a.email}`,meta:a})),[p]),v=o.useMemo(()=>l.map(a=>({value:String(a.id),label:a.name,meta:a})),[l]),g=o.useMemo(()=>{if(!n)return[];const a=[...n.lockup_options?.map(s=>s.lockup_days)??[],n.lockup_days].filter(s=>typeof s=="number");return Array.from(new Set(a)).sort((s,C)=>s-C).map(s=>({value:String(s),label:`${s}`}))},[n]);o.useEffect(()=>{const a=l.find(c=>String(c.id)===String(r.investment_plan_id))||null;j(a),i("chosen_lockup_days","")},[r.investment_plan_id]);function S(a){a.preventDefault(),h(route("admin.customer-plans.store"),{onSuccess:()=>{u.success("Plano vinculado ao cliente com sucesso.")},onError:()=>{u.error("Erro ao vincular plano ao cliente. Verifique os campos.")}})}return e.jsxs(L,{children:[e.jsx(k,{title:"Vincular Plano"}),e.jsxs(N,{children:[e.jsx(P,{children:e.jsx(B,{className:"text-2xl",children:"Vincular plano a cliente"})}),e.jsx(E,{children:e.jsxs("form",{onSubmit:S,className:"grid gap-6 md:grid-cols-2",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx(d,{children:"Cliente"}),e.jsx(m,{value:String(r.user_id||""),onChange:a=>i("user_id",a),items:f,placeholder:"Selecione o cliente…",searchPlaceholder:"Buscar cliente…"}),t.user_id&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:t.user_id})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx(d,{children:"Plano"}),e.jsx(m,{value:String(r.investment_plan_id||""),onChange:(a,c)=>i("investment_plan_id",a),items:v,placeholder:"Selecione o plano…",searchPlaceholder:"Buscar plano…"}),t.investment_plan_id&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:t.investment_plan_id})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx(d,{children:"Carência (dias) — opcional"}),e.jsx(m,{value:String(r.chosen_lockup_days||""),onChange:a=>i("chosen_lockup_days",a),items:g,placeholder:n?"Escolha ou deixe em branco p/ padrão":"Selecione um plano primeiro",searchPlaceholder:"Buscar carência…"}),t.chosen_lockup_days&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:t.chosen_lockup_days}),e.jsx("p",{className:"mt-1 text-xs text-muted-foreground",children:"Deixe vazio para usar a carência padrão do plano."})]}),e.jsxs("div",{className:"flex gap-2 md:col-span-2",children:[e.jsx(y,{href:route("admin.customer-plans.index"),children:e.jsx(x,{variant:"outline",children:"Cancelar"})}),e.jsx(x,{type:"submit",disabled:_,children:"Salvar vínculo"})]})]})})]})]})}export{Y as default};
