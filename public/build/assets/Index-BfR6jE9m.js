import{r as o,j as e,u as G,H as be,t as b,a as R}from"./app-D1QTuDhJ.js";import{B as A}from"./button-CjsFrxyq.js";import{P as te,a as ae,C as re,b as le,c as E,d as F,e as I,f as k,g as B,h as Y}from"./popover-CrdbZeVi.js";import{c as N}from"./utils-BkIxhzDH.js";import{C as H}from"./check-tbf6p6GB.js";import{I as ve}from"./input-CHa5w17A.js";import{P as Ne}from"./Index-CLJJewea.js";import{A as U,a as K,b as Q,c as V,d as W,e as X,f as Z,g as ee}from"./alert-dialog-BXiRyJmV.js";import{D as De,a as ye,b as Se,c as Ce,d as se,e as _e}from"./dropdown-menu-CRqzibls.js";import{T as Ae,a as we,b as $,c as y,d as Me,e as v}from"./table-BPMAg_xM.js";import{A as Oe}from"./app-layout-CJjyHprM.js";import{T as _}from"./index-CnTLoYi9.js";import{E as Pe}from"./ellipsis-B7kO5F0b.js";import{T as Te}from"./trash-2-CST2hwSM.js";/* empty css            */import"./createLucideIcon-DFi8gACE.js";import"./index-2tsdWD63.js";import"./index-DwBoTTRC.js";import"./index-B9yUo-Ai.js";import"./index-DvlxdSxl.js";import"./search-CTwqVz6b.js";import"./index-DGw6JHWd.js";import"./index-Dc_FVRD7.js";import"./select-0yqIVW6-.js";import"./index-CWTwyLLH.js";import"./index-CzgvQrgu.js";import"./proxy-BH5ppGYh.js";const ne=[{mm:"01",label:"Janeiro"},{mm:"02",label:"Fevereiro"},{mm:"03",label:"Março"},{mm:"04",label:"Abril"},{mm:"05",label:"Maio"},{mm:"06",label:"Junho"},{mm:"07",label:"Julho"},{mm:"08",label:"Agosto"},{mm:"09",label:"Setembro"},{mm:"10",label:"Outubro"},{mm:"11",label:"Novembro"},{mm:"12",label:"Dezembro"}],Re=Array.from({length:102},(i,t)=>String(2101-t));function $e({value:i,onChange:t}){const[a,c]=o.useState(!1),h=new Date,d=String(h.getFullYear()),p=String(h.getMonth()+1).padStart(2,"0"),r=i?.slice(0,4)??d,m=i?.slice(5,7)??p,f=(n,x)=>{t(`${n}-${x}`),c(!1)},D=o.useMemo(()=>`${ne.find(x=>x.mm===m)?.label??m}/${r}`,[m,r]);return e.jsxs(te,{open:a,onOpenChange:c,children:[e.jsx(ae,{asChild:!0,children:e.jsxs(A,{variant:"outline",role:"combobox","aria-expanded":a,className:"w-48 justify-between",children:[D,e.jsx(re,{className:"size-4 opacity-50"})]})}),e.jsx(le,{className:"w-[360px] p-0",align:"start",children:e.jsxs("div",{className:"grid grid-cols-2 divide-x",children:[e.jsxs(E,{children:[e.jsx(F,{placeholder:"Buscar mês…",className:"h-9"}),e.jsxs(I,{children:[e.jsx(k,{children:"Nenhum mês"}),e.jsx(B,{heading:"Meses",children:ne.map(n=>e.jsxs(Y,{value:n.mm,onSelect:()=>f(r,n.mm),children:[n.label,e.jsx(H,{className:N("ml-auto",m===n.mm?"opacity-100":"opacity-0")})]},n.mm))})]})]}),e.jsxs(E,{children:[e.jsx(F,{placeholder:"Buscar ano…",className:"h-9"}),e.jsxs(I,{children:[e.jsx(k,{children:"Nenhum ano"}),e.jsx(B,{heading:"Anos",children:Re.map(n=>e.jsxs(Y,{value:n,onSelect:()=>f(n,m),children:[n,e.jsx(H,{className:N("ml-auto",r===n?"opacity-100":"opacity-0")})]},n))})]})]})]})})]})}function Ee(i){const[t,a]=o.useState(()=>""),c=d=>{if(d==null){a("");return}const p=d*100;a(String(p).replace(".",","))},h=o.useCallback(()=>{if(!t?.length)return;const d=t.replace(/\s/g,"").replace(".","").replace(",","."),p=Number(d);if(!isNaN(p))return p/100},[t]);return{display:t,setDisplay:a,getDecimal:h,setFromDecimal:c}}function Fe({value:i,onChange:t,placeholder:a="0,00"}){return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ve,{inputMode:"decimal",value:i,onChange:c=>t(c.target.value),placeholder:a,className:"max-w-[120px]"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"%"})]})}function Ie({value:i,onChange:t,items:a,placeholder:c="Selecione...",searchPlaceholder:h="Buscar...",emptyMessage:d="Nenhum item encontrado.",className:p,buttonClassName:r,buttonRightIcon:m,disabled:f,contentWidthClass:D}){const[n,x]=o.useState(!1),S=a.find(j=>j.value===i);return e.jsx("div",{className:N("w-full",p),children:e.jsxs(te,{open:n,onOpenChange:x,children:[e.jsx(ae,{asChild:!0,children:e.jsxs(A,{type:"button",variant:"outline",role:"combobox","aria-expanded":n,disabled:f,className:N("w-full justify-between",r),children:[e.jsx("span",{className:"truncate",children:S?S.label:c}),m??e.jsx(re,{className:"ml-2 h-4 w-4 opacity-50"})]})}),e.jsx(le,{className:N("p-0",D??"w-[--radix-popover-trigger-width]"),align:"start",children:e.jsxs(E,{children:[e.jsx(F,{placeholder:h,className:"h-9"}),e.jsxs(I,{children:[e.jsx(k,{children:d}),e.jsx(B,{children:a.map(j=>e.jsxs(Y,{value:j.value,onSelect:g=>{t(g===i?"":g),x(!1)},children:[e.jsx("span",{className:"truncate",children:j.label}),e.jsx(H,{className:N("ml-auto h-4 w-4",i===j.value?"opacity-100":"opacity-0")})]},j.value))})]})]})})]})})}function ms({plans:i,yields:t,filters:a}){const{data:c,setData:h}=G({per_page:Number(a?.per_page??15)}),d=s=>{R.get(_("admin.monthly-yields.index"),{...c,...s},{preserveScroll:!0,preserveState:!0})},p=s=>{h("per_page",s),d({per_page:s})},{data:r,setData:m,post:f,processing:D,errors:n,reset:x,transform:S}=G({investment_plan_id:"",period:new Date().toISOString().slice(0,7),percent_decimal:""}),{display:j,setDisplay:g,getDecimal:L}=Ee();o.useEffect(()=>{g(r.percent_decimal)},[r.percent_decimal]);const oe=i.map(s=>({value:String(s.id),label:s.name})),ie=s=>{if(s.preventDefault(),!r.investment_plan_id||!/^\d{4}-\d{2}$/.test(r.period))return;const l=L();S(u=>({investment_plan_id:u.investment_plan_id,period:`${u.period}-01`,percent_decimal:l})),f(_("admin.monthly-yields.store"),{onSuccess:()=>{b.success("Rendimento registrado com sucesso."),x(),g("")},onError:()=>{b.error("Erro ao registrar rendimento. Verifique os campos.")}})},[ce,w]=o.useState(null),[de,M]=o.useState(!1),[O,me]=o.useState(null),q=o.useRef(null),pe=s=>{w(null),document.activeElement?.blur?.(),me({id:s.id,label:`${s.plan?.name??"Plano"} — ${T(s.period)}`}),requestAnimationFrame(()=>M(!0))},ue=()=>{O&&R.delete(_("admin.monthly-yields.destroy",{monthlyYield:O.id}),{preserveState:!0,onSuccess:()=>b.success("Rendimento removido com sucesso."),onError:()=>b.error("Erro ao remover rendimento. Tente novamente."),onFinish:()=>M(!1)})},[he,P]=o.useState(!1),[C,xe]=o.useState(null),z=o.useRef(null),je=s=>{w(null),document.activeElement?.blur?.(),xe({planId:s.investment_plan_id,period:J(s.period),label:`${s.plan?.name??"Plano"} — ${T(s.period)}`}),requestAnimationFrame(()=>P(!0))},fe=()=>{C&&R.post(_("admin.monthly-yields.apply"),{investment_plan_id:C.planId,period:C.period},{preserveState:!0,onSuccess:()=>b.success("Rendimento aplicado com sucesso."),onError:()=>b.error("Erro ao aplicar rendimento. Tente novamente."),onFinish:()=>P(!1)})},ge=s=>{const l=typeof s=="string"?parseFloat(s):s;return typeof l=="number"&&!isNaN(l)?`${(l*100).toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2})}%`:"—"};function J(s){if(/^\d{4}-\d{2}$/.test(s))return`${s}-01`;if(/^\d{4}-\d{2}-\d{2}$/.test(s))return`${s.slice(0,7)}-01`;const l=new Date(s);return isNaN(l.getTime())?s:`${l.getFullYear()}-${String(l.getMonth()+1).padStart(2,"0")}-01`}function T(s){const[l,u]=J(s).split("-").map(Number);return new Date(l,(u??1)-1).toLocaleDateString("pt-BR",{year:"numeric",month:"2-digit"})}return e.jsxs(Oe,{children:[e.jsx(be,{title:"Rendimentos Mensais"}),e.jsxs("div",{className:"rounded-xl bg-accent px-3 pt-4",children:[e.jsx("div",{className:"mb-2 flex flex-col items-start justify-between gap-4 sm:flex-row sm:items-center",children:e.jsx("h1",{className:"text-lg font-bold",children:"Rendimentos Mensais"})}),e.jsxs("form",{onSubmit:ie,className:"mb-4 rounded-lg border bg-card p-4",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-3 sm:grid-cols-4",children:[e.jsxs("div",{className:"sm:col-span-2",children:[e.jsx("label",{className:"mb-1 block text-sm font-medium",children:"Plano"}),e.jsx(Ie,{value:r.investment_plan_id,onChange:s=>m("investment_plan_id",s),items:oe,placeholder:"Selecione um plano",emptyMessage:"Nenhum plano encontrado"}),n.investment_plan_id&&e.jsx("p",{className:"mt-1 text-sm text-destructive",children:n.investment_plan_id})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium",children:"Mês"}),e.jsx($e,{value:r.period,onChange:s=>m("period",s)}),n.period&&e.jsx("p",{className:"mt-1 text-sm text-destructive",children:n.period})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium",children:"Rendimento (%)"}),e.jsx(Fe,{value:j,onChange:s=>{g(s),m("percent_decimal",s)},placeholder:"0,00"}),n.percent_decimal&&e.jsx("p",{className:"mt-1 text-sm text-destructive",children:n.percent_decimal})]})]}),e.jsx("div",{className:"mt-4 flex justify-end",children:e.jsx(A,{type:"submit",disabled:D,children:"Registrar"})})]}),e.jsxs("div",{className:"mb-4 rounded-lg",children:[e.jsxs(Ae,{children:[e.jsx(we,{children:e.jsxs($,{children:[e.jsx(y,{children:"ID"}),e.jsx(y,{children:"Plano"}),e.jsx(y,{children:"Mês"}),e.jsx(y,{children:"Percentual"}),e.jsx(y,{className:"text-right",children:e.jsx("span",{className:"sr-only",children:"Ações"})})]})}),e.jsx(Me,{children:t?.data?.length?t.data.map(s=>{const l=ce===s.id;return e.jsxs($,{className:"hover:!bg-secondary/10",children:[e.jsx(v,{children:s.id}),e.jsx(v,{className:"max-w-48 truncate",children:s.plan?.name??"—"}),e.jsx(v,{children:T(s.period)}),e.jsx(v,{children:ge(s?.percent_decimal)}),e.jsx(v,{className:"text-right",children:e.jsxs(De,{open:l,onOpenChange:u=>w(u?s.id:null),children:[e.jsx(ye,{asChild:!0,children:e.jsxs(A,{variant:"ghost",className:"h-8 w-8 p-0",children:[e.jsx("span",{className:"sr-only",children:"Abrir menu"}),e.jsx(Pe,{className:"h-4 w-4"})]})}),e.jsxs(Se,{align:"end",children:[e.jsx(Ce,{children:"Ações"}),e.jsx(se,{onSelect:u=>{u.preventDefault(),je(s)},children:"Aplicar rendimento"}),e.jsx(_e,{}),e.jsxs(se,{className:"text-red-600 focus:text-red-600",onSelect:u=>{u.preventDefault(),pe(s)},children:[e.jsx(Te,{className:"mr-2 h-4 w-4"}),"Remover"]})]})]})})]},s.id)}):e.jsx($,{children:e.jsx(v,{colSpan:5,className:"h-24 text-center text-sm text-muted-foreground",children:"Nenhum rendimento cadastrado."})})})]}),e.jsx(Ne,{meta:t.meta,perPage:c.per_page,setPerPage:p})]})]}),e.jsx(U,{open:de,onOpenChange:M,children:e.jsxs(K,{onOpenAutoFocus:s=>{s.preventDefault(),q.current?.focus()},children:[e.jsxs(Q,{children:[e.jsx(V,{children:"Remover rendimento?"}),e.jsx(W,{children:O?.label})]}),e.jsxs(X,{children:[e.jsx(Z,{ref:q,children:"Cancelar"}),e.jsx(ee,{className:"bg-red-600 hover:bg-red-700",onClick:ue,children:"Remover"})]})]})}),e.jsx(U,{open:he,onOpenChange:P,children:e.jsxs(K,{onOpenAutoFocus:s=>{s.preventDefault(),z.current?.focus()},children:[e.jsxs(Q,{children:[e.jsx(V,{children:"Aplicar rendimento deste mês?"}),e.jsxs(W,{children:[C?.label,e.jsx("br",{}),"Esta ação irá lançar o rendimento como transações aprovadas para todos os vínculos ativos deste plano que já estavam ativados até o fim do período selecionado."]})]}),e.jsxs(X,{children:[e.jsx(Z,{ref:z,children:"Cancelar"}),e.jsx(ee,{onClick:fe,children:"Aplicar rendimento"})]})]})})]})}export{ms as default};
