import{u as H,r as m,j as e,a as d,t as h}from"./app-BTymDE-b.js";import{P as q}from"./Index-BJE5hFwe.js";import{S as $,B as Q}from"./status-badge-BcZv8WiZ.js";import{A as V,a as G,b as J,c as K,d as U,e as W,f as X,g as Y}from"./alert-dialog-DiBo0ReV.js";import{B as w}from"./button-0cFyQk5l.js";import{D as Z,a as ee,b as se,c as re,e as A,d as D}from"./dropdown-menu-8hpJ0En7.js";import{I as te}from"./input-CeqObPA2.js";import{T as ae,a as oe,b as S,c as n,d as ne,e as a}from"./table-DufyZNTU.js";import{u as le,a as ie,P}from"./useSort-DTQgZe5x.js";import{f as _}from"./index-9YGKT2P1.js";import{T as l}from"./index-CnTLoYi9.js";import{S as ce}from"./search-CIJ9iWFu.js";import{E as de}from"./ellipsis-ChGD3H5v.js";import{T as me}from"./trash-2-Bf6h3e5I.js";/* empty css            */import"./select-CXekZFRK.js";import"./index-Dc_FVRD7.js";import"./index-C9ZXAN1u.js";import"./index-CcDKZjMs.js";import"./createLucideIcon-CdDXl1n5.js";import"./index-C1SMWg6O.js";import"./index-DOyuSIH3.js";import"./index-BjsA19nC.js";import"./utils-BkIxhzDH.js";import"./check-CpxbXbUo.js";import"./badge-FDCXrNx6.js";import"./index-B3n4jYYB.js";import"./index-85cLjII4.js";import"./proxy-BMoTdZYb.js";function He({pagination:x,filters:r}){const{data:u,setData:y}=H({search:typeof r.search=="string"?r.search:"","per-page":typeof r["per-page"]=="number"?r["per-page"]:15,"sort-by":typeof r["sort-by"]=="string"?r["sort-by"]:"id",direction:r.direction||"asc"}),{handleDebounceFilter:B}=le({initialData:void 0,path:l("admin.customer-plans.index"),onDataChange:y}),{handleSort:E,getSortDirection:i}=ie({sortBy:typeof r["sort-by"]=="string"?r["sort-by"]:"id",sortDirection:r.direction||"asc"}),T=s=>{const t={...u,"per-page":s};y(t),d.get(l("admin.customer-plans.index"),_(t),{preserveState:!0,preserveScroll:!0})},c=s=>{const t=E(s),b={...u,...t};d.get(l("admin.customer-plans.index"),_(b),{preserveState:!0,preserveScroll:!0})},I=x.data.length>0,O=s=>s?new Date(s).toLocaleDateString("pt-BR"):"—",[M,p]=m.useState(null),[F,j]=m.useState(!1),[N,v]=m.useState(null),[k,g]=m.useState(""),[f,C]=m.useState(!1),R=(s,t)=>{p(null),document.activeElement?.blur?.(),requestAnimationFrame(()=>{v(s),g(t),j(!0)})},L=()=>{N&&(C(!0),d.delete(l("admin.customer-plans.destroy",{customerPlan:N}),{preserveState:!0,preserveScroll:!0,onSuccess:()=>{h.success("Plano de cliente removido com sucesso.")},onError:()=>{h.error("Erro ao remover plano de cliente.")},onFinish:()=>{C(!1),j(!1),v(null),g("")}}))};return e.jsxs("div",{className:"rounded-xl bg-accent px-3 pt-4",children:[e.jsxs("div",{className:"flex flex-col items-start justify-between gap-4 sm:flex-row sm:items-center",children:[e.jsx("h1",{className:"text-lg font-bold",children:"Planos de Clientes"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(te,{leftIcon:e.jsx(ce,{className:"size-4"}),name:"search",placeholder:"Buscar clientes...",id:"search",value:u.search,onChange:B,className:"w-full sm:max-w-sm"}),e.jsxs(w,{type:"button",size:"sm",className:"cursor-pointer",onClick:()=>d.visit(l("admin.customer-plans.create")),children:[e.jsx("span",{className:"text-xs",children:"Vincular plano"}),e.jsx(P,{className:"size-4"})]})]})]}),e.jsx("div",{className:"mt-4",children:e.jsx("div",{className:"overflow-hidden",children:e.jsxs(ae,{children:[e.jsx(oe,{children:e.jsxs(S,{children:[e.jsx(n,{sortable:!0,sortBy:"id",sortDirection:i("id"),onSort:c,children:"ID"}),e.jsx(n,{sortable:!0,sortBy:"user_id",sortDirection:i("user_id"),onSort:c,children:"Cliente"}),e.jsx(n,{sortable:!0,sortBy:"investment_plan_id",sortDirection:i("investment_plan_id"),onSort:c,children:"Plano"}),e.jsx(n,{sortable:!0,sortBy:"chosen_lockup_days",sortDirection:i("chosen_lockup_days"),onSort:c,children:"Carência"}),e.jsx(n,{sortable:!0,sortBy:"activated_on",sortDirection:i("activated_on"),onSort:c,children:"Ativado em"}),e.jsx(n,{sortable:!0,sortBy:"status",sortDirection:i("status"),onSort:c,children:"Status"}),e.jsx(n,{children:e.jsx("span",{className:"sr-only",children:"Ações"})})]})}),e.jsx(ne,{children:I?x.data.map((s,t)=>{const b=s.status==="pre_active",z=M===s.id;return e.jsxs(S,{className:"hover:!bg-secondary/10",children:[e.jsx(a,{children:t+1}),e.jsx(a,{children:s.customer?.name}),e.jsx(a,{children:s.plan?.name}),e.jsx(a,{children:s.chosen_lockup_days||s.plan?.lockup_days||"—"}),e.jsx(a,{children:e.jsx($,{status:s.status})}),e.jsx(a,{children:O(s.activated_on)}),e.jsx(a,{className:"text-right",children:e.jsxs(Z,{open:z,onOpenChange:o=>p(o?s.id:null),children:[e.jsx(ee,{asChild:!0,children:e.jsxs(w,{variant:"ghost",className:"h-8 w-8 p-0",children:[e.jsx("span",{className:"sr-only",children:"Abrir menu"}),e.jsx(de,{className:"h-4 w-4"})]})}),e.jsxs(se,{align:"end",children:[e.jsx(re,{children:"Ações"}),e.jsx(A,{}),b&&e.jsxs(D,{onSelect:o=>{o.preventDefault(),p(null),document.activeElement?.blur?.(),d.post(l("admin.customer-plans.activate",{customerPlan:s.id}),{},{preserveState:!0,preserveScroll:!0,onSuccess:()=>{h.success("Plano de cliente ativado com sucesso.")},onError:()=>{h.error("Erro ao ativar plano de cliente.")}})},children:[e.jsx(Q,{className:"mr-2 h-4 w-4 text-emerald-600"}),"Ativar plano"]}),e.jsxs(D,{onSelect:o=>{o.preventDefault(),p(null),document.activeElement?.blur?.(),d.visit(l("admin.deposits.create",{cp:s.id}))},children:[e.jsx(P,{className:"mr-2 h-4 w-4"}),"Novo aporte"]}),e.jsx(A,{}),e.jsxs(D,{className:"text-red-600 focus:text-red-600",onSelect:o=>{o.preventDefault(),R(s.id,`${s.customer?.name} — ${s.plan?.name}`)},children:[e.jsx(me,{className:"mr-2 h-4 w-4"}),"Remover"]})]})]})})]},String(s.id))}):e.jsx(S,{children:e.jsx(a,{colSpan:7,className:"h-24 text-center text-sm text-muted-foreground",children:"Nenhum plano de cliente encontrado."})})})]})})}),e.jsx(V,{open:F,onOpenChange:s=>{j(s),s||(v(null),g(""))},children:e.jsxs(G,{onOpenAutoFocus:s=>s.preventDefault(),children:[e.jsxs(J,{children:[e.jsx(K,{children:"Confirmar remoção"}),e.jsxs(U,{children:["Esta ação removerá o vínculo ",e.jsx("strong",{children:k}),". Não será possível remover se houver aportes aprovados."]})]}),e.jsxs(W,{children:[e.jsx(X,{disabled:f,children:"Cancelar"}),e.jsx(Y,{className:"bg-red-600 text-white hover:bg-red-700",onClick:L,disabled:f,children:f?"Removendo...":"Remover"})]})]})}),e.jsx(q,{meta:x?.meta,perPage:Number(u["per-page"]),setPerPage:T})]})}export{He as CustomerPlanList};
