import{u as H,r as c,j as e,a as l,t as p}from"./app-DQPXqyy6.js";import{P as q}from"./Index-J7DcMISg.js";import{S as $,B as Q}from"./status-badge-Cc9q639b.js";import{A as V,a as G,b as J,c as K,d as U,e as W,f as X,g as Y}from"./alert-dialog-DeYUn2X1.js";import{B as A}from"./button-D5vWEiac.js";import{D as Z,a as ee,b as se,c as re,e as P,d as S}from"./dropdown-menu-BGF5fV-q.js";import{I as te}from"./input-DyStY0q5.js";import{T as ae,a as ne,b as D,c as n,d as oe,e as t}from"./table-CEcLtHF-.js";import{u as le,a as ie,P as y}from"./useSort-Df7S5d4M.js";import{f as E}from"./index-9YGKT2P1.js";import{T as o}from"./index-CnTLoYi9.js";import{S as ce}from"./search-CdWRY7Gz.js";import{E as me}from"./ellipsis-DPA6U6Uv.js";import{T as de}from"./trash-2-CJ2-wwRz.js";/* empty css            */import"./select-j1y55RD1.js";import"./index-Dc_FVRD7.js";import"./index-BXjLavUZ.js";import"./index-BTFQTnP1.js";import"./createLucideIcon-DTltB1YP.js";import"./index-D3GA1IrA.js";import"./index-CdpUR5B_.js";import"./index-DNtamNmN.js";import"./utils-BkIxhzDH.js";import"./check-1cbie2Cp.js";import"./badge-DqPQ3dnD.js";import"./index-DCU4N4gc.js";import"./index-B9BnfCey.js";import"./proxy-hqGVL8UZ.js";function He({pagination:h,filters:m}){const{data:i,setData:b}=H({search:m.search||"","per-page":m["per-page"]||15}),{handleDebounceFilter:T}=le({path:o("admin.customer-plans.index"),initialData:i,onDataChange:b}),{handleSort:B,getSortDirection:N}=ie({sortBy:m["sort-by"]||"status",sortDirection:m.direction||"asc"}),I=s=>{const r={...i,"per-page":s};b(r),l.get(o("admin.customer-plans.index"),E(r),{preserveState:!0,preserveScroll:!0})},d=s=>{const r=B(s),g={...i,...r};l.get(o("admin.customer-plans.index"),E(g),{preserveState:!0,preserveScroll:!0})},O=h.data.length>0,M=s=>s?new Date(s).toLocaleDateString("pt-BR"):"—",[_,u]=c.useState(null),[F,x]=c.useState(!1),[C,j]=c.useState(null),[R,v]=c.useState(""),[f,w]=c.useState(!1),k=(s,r)=>{u(null),document.activeElement?.blur?.(),requestAnimationFrame(()=>{j(s),v(r),x(!0)})},L=()=>{C&&(w(!0),l.delete(o("admin.customer-plans.destroy",{customerPlan:C}),{preserveState:!0,preserveScroll:!0,onSuccess:()=>{p.success("Plano de cliente removido com sucesso.")},onError:()=>{p.error("Erro ao remover plano de cliente.")},onFinish:()=>{w(!1),x(!1),j(null),v("")}}))};return e.jsxs("div",{className:"rounded-xl bg-accent px-3 pt-4",children:[e.jsxs("div",{className:"flex flex-col items-start justify-between gap-4 sm:flex-row sm:items-center",children:[e.jsx("h1",{className:"text-lg font-bold",children:"Planos de Clientes"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(te,{leftIcon:e.jsx(ce,{className:"size-4"}),name:"search",placeholder:"Buscar clientes...",id:"search",value:i.search,onChange:T,className:"w-full sm:max-w-sm"}),e.jsxs(A,{type:"button",size:"sm",className:"cursor-pointer",onClick:()=>l.visit(o("admin.customer-plans.create")),children:[e.jsx("span",{className:"text-xs",children:"Vincular plano"}),e.jsx(y,{className:"size-4"})]})]})]}),e.jsx("div",{className:"mt-4",children:e.jsx("div",{className:"overflow-hidden",children:e.jsxs(ae,{children:[e.jsx(ne,{children:e.jsxs(D,{children:[e.jsx(n,{children:"ID"}),e.jsx(n,{sortable:!0,sortBy:"name",sortDirection:N("name"),onSort:d,children:"Cliente"}),e.jsx(n,{children:"Plano"}),e.jsx(n,{sortable:!0,onSort:()=>d("chosen_lockup_days"),children:"Carência escolhida (dias)"}),e.jsx(n,{sortable:!0,sortBy:"status",sortDirection:N("status"),onSort:d,children:"Status"}),e.jsx(n,{sortable:!0,onSort:()=>d("activated_on"),children:"Ativado em"}),e.jsx(n,{children:e.jsx("span",{className:"sr-only",children:"Ações"})})]})}),e.jsx(oe,{children:O?h.data.map((s,r)=>{const g=s.status==="pre_active",z=_===s.id;return e.jsxs(D,{className:"hover:!bg-secondary/10",children:[e.jsx(t,{children:r+1}),e.jsx(t,{children:s.customer?.name}),e.jsx(t,{children:s.plan?.name}),e.jsx(t,{children:s.chosen_lockup_days||s.plan?.lockup_days||"—"}),e.jsx(t,{children:e.jsx($,{status:s.status})}),e.jsx(t,{children:M(s.activated_on)}),e.jsx(t,{className:"text-right",children:e.jsxs(Z,{open:z,onOpenChange:a=>u(a?s.id:null),children:[e.jsx(ee,{asChild:!0,children:e.jsxs(A,{variant:"ghost",className:"h-8 w-8 p-0",children:[e.jsx("span",{className:"sr-only",children:"Abrir menu"}),e.jsx(me,{className:"h-4 w-4"})]})}),e.jsxs(se,{align:"end",children:[e.jsx(re,{children:"Ações"}),e.jsx(P,{}),g&&e.jsxs(S,{onSelect:a=>{a.preventDefault(),u(null),document.activeElement?.blur?.(),l.post(o("admin.customer-plans.activate",{customerPlan:s.id}),{},{preserveState:!0,preserveScroll:!0,onSuccess:()=>{p.success("Plano de cliente ativado com sucesso.")},onError:()=>{p.error("Erro ao ativar plano de cliente.")}})},children:[e.jsx(Q,{className:"mr-2 h-4 w-4 text-emerald-600"}),"Ativar plano"]}),e.jsxs(S,{onSelect:a=>{a.preventDefault(),u(null),document.activeElement?.blur?.(),l.visit(o("admin.deposits.create",{cp:s.id}))},children:[e.jsx(y,{className:"mr-2 h-4 w-4"}),"Novo aporte"]}),e.jsx(P,{}),e.jsxs(S,{className:"text-red-600 focus:text-red-600",onSelect:a=>{a.preventDefault(),k(s.id,`${s.customer?.name} — ${s.plan?.name}`)},children:[e.jsx(de,{className:"mr-2 h-4 w-4"}),"Remover"]})]})]})})]},String(s.id))}):e.jsx(D,{children:e.jsx(t,{colSpan:7,className:"h-24 text-center text-sm text-muted-foreground",children:"Nenhum plano de cliente encontrado."})})})]})})}),e.jsx(V,{open:F,onOpenChange:s=>{x(s),s||(j(null),v(""))},children:e.jsxs(G,{onOpenAutoFocus:s=>s.preventDefault(),children:[e.jsxs(J,{children:[e.jsx(K,{children:"Confirmar remoção"}),e.jsxs(U,{children:["Esta ação removerá o vínculo ",e.jsx("strong",{children:R}),". Não será possível remover se houver aportes aprovados."]})]}),e.jsxs(W,{children:[e.jsx(X,{disabled:f,children:"Cancelar"}),e.jsx(Y,{className:"bg-red-600 text-white hover:bg-red-700",onClick:L,disabled:f,children:f?"Removendo...":"Remover"})]})]})}),e.jsx(q,{meta:h?.meta,perPage:i["per-page"],setPerPage:I})]})}export{He as CustomerPlanList};
